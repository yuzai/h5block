(function(e,t){var n=screen.availHeight;var i=screen.availWidth;document.getElementById("h5lock").style.height=n+"px";var r=document.getElementById("canvas");var a=document.getElementById("hint");var o=document.getElementById("radio");var c=document.getElementById("reset");var l=document.querySelectorAll("input[name='model']");r.width=300;r.height=300;var f=r.getContext("2d");var h=[];var s=r.width/12;var u={};var d=[];var v=[];var g=[];var m=false;var y="set";var x=[0,1,2,4,6,7,8];localStorage.setItem("code",x);var T=0;var L="#ff0000";var p="#00ff00";function M(){var e=[];for(var t=0;t<9;t++){var n={};n.x=r.width/3/2+t%3*r.width/3;n.y=r.width/3/2+Math.floor(t/3)*r.height/3;e.push(n)}return e}function H(e,t,n,i,r){var a=n||s;var o=r||"#000000";f.fillStyle=o;f.strokeStyle=o;f.lineWidth=2;f.beginPath();f.arc(e,t,a,0,2*Math.PI);f.closePath();if(i){f.fill()}else{f.stroke()}}function k(e,t,n,i){f.strokeStyle=i||"#000000";f.lineWidth=3;f.beginPath();f.moveTo(e[0].x,e[0].y);for(var r=1,a=d.length;r<a;r++){f.lineTo(e[r].x,e[r].y)}if(t&&n){f.lineTo(t,n)}f.stroke();f.closePath()}function S(e){var t={};t.x=0;t.y=0;var n=e;while(n){t.x+=n.offsetLeft;t.y+=n.offsetTop;n=n.offsetPatent}return t}function w(e){m=true;g=[];d=[];v=h.slice().map(function(e,t){e.index=t;return e})}function E(e){if(m){f.clearRect(0,0,r.width,r.height);h.map(function(e){H(e.x,e.y)});var t=e.touches?e.touches[0].pageX-u.x:e.pageX-u.x;var n=e.touches?e.touches[0].pageY-u.y:e.pageY-u.y;if(d.length!==0){k(d,t,n);for(var i=0,a=d.length;i<a;i++){H(d[i].x,d[i].y,s/2,true)}}for(var i=0,a=v.length;i<a;i++){if(t>=v[i].x-s&&t<=v[i].x+s&&n>=v[i].y-s&&n<=v[i].y+s){d.push(v[i]);g.push(v[i].index);v.splice(i,1);break}}}}function I(e){var n;if(m){m=false;if(y==="set"){if(g.length<5){n=L;a.innerHTML="密码太短，至少需要5个点";setTimeout(function(){a.innerHTML="请重新设置初始密码"},1e3);T=0}else if(T===1){if(g.toString()!==x.toString()){n=L;a.innerHTML="两次密码不一致";setTimeout(function(){a.innerHTML="请重新设置初始密码"},1e3)}else{n=p;a.innerHTML="密码设置成功";x=g.slice();localStorage.setItem("code",x)}T=0}else if(T===0){x=g.slice();T++;n=p;a.innerHTML="请再次输入手势密码"}}else if(y==="check"){if(g.toString()!==localStorage.code){n=L;a.innerHTML="输入的密码不正确"}else{n=p;a.innerHTML="密码正确!"}}f.clearRect(0,0,r.width,r.height);h.map(function(e){H(e.x,e.y)});if(d.length!==0){k(d,t,t,n);for(var i=0,o=d.length;i<o;i++){H(d[i].x,d[i].y,s/2,true);H(d[i].x,d[i].y,t,t,n)}}setTimeout(function(){f.clearRect(0,0,r.width,r.height);h.map(function(e){H(e.x,e.y)})},500)}}function P(e){y=e.target.value;T=0;if(y==="set"){a.innerHTML="请设置初始密码"}else if(y==="check"){if(localStorage.code){a.innerHTML="请输入正确的手势密码"}else{a.innerHTML="您还没有设置密码";setTimeout(function(){e.target.checked=false;l[0].checked=true;a.innerHTML="请先设置密码"},500)}}}function B(){T=0;y="set";l[0].checked=true;l[1].checked=false;a.innerHTML="旧密码已删除，请重新设置密码";delete localStorage.code}function b(){h=M();v=h.slice().map(function(e,t){e.index=t;return e});h.map(function(e){H(e.x,e.y)});u=S(r);r.addEventListener("touchstart",w);r.addEventListener("touchmove",E);r.addEventListener("touchend",I);o.addEventListener("change",P);c.addEventListener("click",B)}b()})(window,undefined);